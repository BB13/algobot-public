# Operator Interfaces

## Why it matters
AlgoBot balances automation with human oversight through multiple interfaces. Understanding what each surface offers (and how it authenticates) helps reviewers evaluate usability and security.

## Web interfaces
- **Settings console** – HTML templates in [`src/frontend/settings.html`](../src/frontend/settings.html) and supporting static assets provide a SPA-like experience for editing configuration. Authentication relies on the same API key used by the REST settings endpoints.
- **Webhook explorer** – [`src/frontend/webhook.html`](../src/frontend/webhook.html) documents payload structure for manual testing; it reuses the webhook API under the hood.
- **Charts & dashboards** – [`src/frontend/charts.html`](../src/frontend/charts.html) showcases chart capture outputs generated by Telegram commands (see below).

### Request flow
1. Operator logs in via `/settings/login`, submitting the `SETTINGS_API_KEY`.
2. Frontend fetches the current configuration (`GET /api/settings`).
3. Edits are staged client-side and submitted via `PATCH /api/settings`, with diff visualisation before confirmation.
4. Responses update local state and show success/failure banners.

## Telegram bot
- **Bootstrap** – [`src/telegram/telegram_bot.py`](../src/telegram/telegram_bot.py) initialises the `python-telegram-bot` application with command handlers loaded from [`telegram_commands.py`](../src/telegram/telegram_commands.py) and callbacks (`telegram_callbacks.py`).
- **Key commands**
  - `/status` – Summarises open positions and adapter mode using repository data.
  - `/close <symbol>` – Calls `PositionService.close_position` for manual intervention.
  - `/chart <symbol>` – Generates chart snapshots via [`chart_capture.py`](../src/telegram/chart_capture.py) and sends them back to chat.
  - `/settings` – Returns the latest config excerpt for quick verification.
- **Security** – Chat access is limited to IDs listed in `user_config.yaml`; unapproved users are logged via [`telegram_users.py`](../src/telegram/telegram_users.py).

## REST APIs
- **Webhook endpoint** – [`src/api/webhook.py`](../src/api/webhook.py)
  - `POST /api/webhook`
  - Headers/body must include `WEBHOOK_API_KEY` and optionally `TELEGRAM_SECRET` for notifications.
  - Returns execution summary including order IDs, fills, and resulting position state.
- **Settings API** – [`src/api/settings_api.py`](../src/api/settings_api.py)
  - `GET /api/settings` for the entire configuration tree.
  - `PATCH /api/settings` accepts partial updates; nested paths allow precise edits (e.g., `{"trade": {"max_concurrent": 3}}`).
- **Settings UI router** – [`src/api/settings_web_ui.py`](../src/api/settings_web_ui.py) serves the static templates and ensures API-key gated access.

## Notifications & observability
- Every successful trade action triggers Telegram notifications via [`telegram_notifications.py`](../src/telegram/telegram_notifications.py), mirroring the REST response payload.
- Web UI interactions surface toast notifications and log entries, while backend logs capture both the API request metadata and any repository mutations.

## Related references
- `docs/trade-lifecycle.md` for execution context behind API responses
- `src/docs/telegram.md` (legacy command catalogue)